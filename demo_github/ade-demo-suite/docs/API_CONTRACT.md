# ADE Demo Suite — API Contract
This document describes the JSON contracts used by the ADE Demo Suite backend
for the four main domains:
- Console
- Observer
- Forge (Planner)
- Memory
All endpoints are exposed under the `/api/*` prefix by the FastAPI backend in
`DEMO_MODE=1`.
The contracts below are aligned with the Pydantic schemas and endpoints used in
the demo.
---
## 1. Console API
Base path: `/api/console`
### 1.1. Execute command
`POST /api/console/exec`
Execute a console command and return a structured event.
Request body:
```json
{
  "command": "ade-state",
  "args": []
}
```
- `command` (string, required): the command name to execute.
- `args` (array of strings, optional): positional arguments.
Response body (example):
```json
{
  "id": "evt_001",
  "ts": "2026-02-05T18:00:00Z",
  "command": "ade-state",
  "args": [],
  "out": "ADE Status: OPERATIONAL",
  "err": "",
  "status": "ok"
}
```
Fields:
- `id` (string): event identifier.
- `ts` (ISO 8601 string): timestamp.
- `command` (string): executed command.
- `args` (array of strings): arguments used.
- `out` (string): standard output.
- `err` (string): standard error (empty if none).
- `status` (string): `"ok"` or `"error"`.
### 1.2. Get history
`GET /api/console/history`
Return the list of recent console events.
Query parameters:
- `limit` (integer, optional): maximum number of events to return (default: backend-defined).
Response body (example):
```json
[
  {
    "id": "evt_001",
    "ts": "2026-02-05T18:00:00Z",
    "command": "ade-state",
    "args": [],
    "out": "ADE Status: OPERATIONAL",
    "err": "",
    "status": "ok"
  },
  {
    "id": "evt_002",
    "ts": "2026-02-05T18:01:00Z",
    "command": "ade-observer-check",
    "args": [],
    "out": "Stub execution of ade-observer-check",
    "err": "",
    "status": "ok"
  }
]
```
---
## 2. Observer API
Base path: `/api/observer`
### 2.1. List events
`GET /api/observer/events`
Return a list of observer events.
Query parameters:
- `limit` (integer, optional): maximum number of events to return (default: backend-defined).
Response body (example):
```json
[
  {
    "id": "obs_evt_001",
    "ts": "2026-02-05T18:00:10Z",
    "source": "FSWatcher",
    "kind": "FS_CHANGE",
    "payload": {
      "path": "demo/sandbox/config.yaml",
      "change": "modified"
    }
  },
  {
    "id": "obs_evt_002",
    "ts": "2026-02-05T18:00:15Z",
    "source": "SystemWatcher",
    "kind": "command_run",
    "payload": {
      "command": "docker-compose restart app"
    }
  }
]
```
Fields:
- `id` (string): event identifier.
- `ts` (ISO 8601 string): timestamp.
- `source` (string): origin of the event (e.g. `FSWatcher`, `SystemWatcher`, `ObserverStub`).
- `kind` (string): type of event (e.g. `FS_CHANGE`, `command_run`, `observer_hint`).
- `payload` (object): structured details, schema depends on `kind`.
### 2.2. List suggestions
`GET /api/observer/suggest`
Return a list of suggestions generated by the Observer.
Response body (example):
```json
[
  {
    "id": "sugg_001",
    "ts": "2026-02-05T18:00:30Z",
    "title": "Automate Restart",
    "description": "You are repeatedly editing config.yaml and restarting the same service. Consider automating this flow.",
    "hint": "leggi scripts/auto-restart.sh",
    "priority": "HIGH"
  }
]
```
Fields:
- `id` (string): suggestion identifier.
- `ts` (ISO 8601 string): timestamp.
- `title` (string): short title.
- `description` (string): human-readable explanation.
- `hint` (string, optional): suggested action (e.g. ADE command).
- `priority` (string): `"CRITICAL"`, `"HIGH"`, `"INFO"` or similar.
### 2.3. Analyze event (scenario runner)
`POST /api/observer/analyze`
Ingest a single event into the Observer engine (used by `demo_runner.py` and `micro_live.py`).
Request body (example):
```json
{
  "ts": "2026-02-05T18:00:05Z",
  "source": "editor",
  "kind": "file_edit",
  "payload": {
    "path": "demo/sandbox/config.yaml",
    "change": "value_updated"
  }
}
```
Fields:
- `ts` (ISO 8601 string, optional): timestamp; if omitted, backend may fill it.
- `source` (string): origin of the event (e.g. `editor`, `terminal`, `observer_stub`).
- `kind` (string): type of event (e.g. `editor_focus`, `file_edit`, `terminal_focus`, `command_run`, `observer_hint`).
- `payload` (object): structured details, schema depends on `kind`.
Response body (example):
```json
{
  "status": "accepted"
}
```
Fields:
- `status` (string): `"accepted"` or `"error"` (demo stub is deterministic and usually returns `"accepted"`).
---
## 3. Forge (Planner) API
Base path: `/api/forge`
The Forge API works with **plans** identified by `plan_id`.
The demo uses a stub (`ForgeStub`) that returns deterministic plans and statuses.
### 3.1. Create a new plan
`POST /api/forge/plan/new`
Create a new plan based on a goal and optional metadata.
Request body (example):
```json
{
  "goal": "Stabilize config.yaml and restart safely",
  "plan_type": "demo",
  "profile": "default"
}
```
Fields:
- `goal` (string, required): human-readable goal.
- `plan_type` (string, optional): type/category of plan (e.g. `"demo"`).
- `profile` (string, optional): Forge profile to use (e.g. `"default"`).
Response body (example):
```json
{
  "plan_id": "plan_001",
  "status": "created",
  "steps": [
    {
      "id": "step_1",
      "description": "Review current config.yaml",
      "status": "pending"
    },
    {
      "id": "step_2",
      "description": "Apply safe restart procedure",
      "status": "pending"
    }
  ]
}
```
Fields:
- `plan_id` (string): unique identifier of the plan.
- `status` (string): `"created"`, `"running"`, `"completed"`, `"verified"`, `"error"`, etc.
- `steps` (array of objects):
  - `id` (string): step identifier.
  - `description` (string): human-readable description.
  - `status` (string): `"pending"`, `"running"`, `"completed"`, `"skipped"`, `"error"`.
### 3.2. Run a plan
`POST /api/forge/plan/run`
Run an existing plan.
Request body (example):
```json
{
  "plan_id": "plan_001"
}
```
Fields:
- `plan_id` (string, required): identifier of the plan to run.
Response body (example):
```json
{
  "plan_id": "plan_001",
  "status": "completed",
  "steps": [
    {
      "id": "step_1",
      "description": "Review current config.yaml",
      "status": "completed"
    },
    {
      "id": "step_2",
      "description": "Apply safe restart procedure",
      "status": "completed"
    }
  ]
}
```
### 3.3. Verify a plan
`POST /api/forge/plan/verify`
Verify the outcome of a plan.
Request body (example):
```json
{
  "plan_id": "plan_001"
}
```
Response body (example):
```json
{
  "plan_id": "plan_001",
  "status": "verified",
  "steps": [
    {
      "id": "step_1",
      "description": "Review current config.yaml",
      "status": "completed"
    },
    {
      "id": "step_2",
      "description": "Apply safe restart procedure",
      "status": "completed"
    }
  ]
}
```
### 3.4. Heal a plan
`POST /api/forge/plan/heal`
Heal a specific step of a plan.
Request body (example):
```json
{
  "plan_id": "plan_001",
  "step_id": "step_2"
}
```
Fields:
- `plan_id` (string, required): identifier of the plan.
- `step_id` (string, required): identifier of the step to heal.
Response body (example):
```json
{
  "plan_id": "plan_001",
  "step_id": "step_2",
  "status": "healed"
}
```
Fields:
- `plan_id` (string): plan identifier.
- `step_id` (string): step identifier.
- `status` (string): `"healed"` or `"error"`.
---
## 4. Memory API
Base path: `/api/memory`
The Memory API stores and retrieves simple items with timestamps and optional tags.
### 4.1. Put (store) a memory item
`POST /api/memory/put`
Store a new memory item.
Request body (example):
```json
{
  "key": "restart_policy",
  "content": "Avoid restarts during peak hours.",
  "tags": ["policy", "restart", "observer"]
}
```
Fields:
- `key` (string, required): logical key or identifier.
- `content` (string, required): text content of the memory item.
- `tags` (array of strings, optional): tags for filtering/search.
Response body (example):
```json
{
  "id": "mem_001",
  "ts": "2026-02-05T18:02:00Z",
  "key": "restart_policy",
  "content": "Avoid restarts during peak hours.",
  "tags": ["policy", "restart", "observer"]
}
```
Fields:
- `id` (string): internal identifier.
- `ts` (ISO 8601 string): timestamp assigned by the backend.
- `key` (string): key as provided.
- `content` (string): content as provided.
- `tags` (array of strings): tags as provided (or empty array).
### 4.2. Query memory
`POST /api/memory/query`
Query memory items by text and/or tags.
Request body (example):
```json
{
  "query": "restart",
  "tags": ["policy"]
}
```
Fields:
- `query` (string, optional): free-text query; if omitted, all items may be returned or filtered only by tags.
- `tags` (array of strings, optional): tags to filter by.
Response body (example):
```json
[
  {
    "id": "mem_001",
    "ts": "2026-02-05T18:02:00Z",
    "key": "restart_policy",
    "content": "Avoid restarts during peak hours.",
    "tags": ["policy", "restart", "observer"]
  }
]
```
Items are typically ordered by `ts` descending (most recent first).
---
## 5. Safety model (demo scope)
Even in this demo, the API contracts are designed to reflect ADE’s safety model:
- **Console**:
  - commands are explicit,
  - outputs are structured and logged.
- **Observer**:
  - only observes scripted events,
  - suggestions are read-only hints.
- **Forge**:
  - plans are explicit objects with steps and statuses,
  - in the real system, execution happens only after explicit human approval.
- **Memory**:
  - stores decisions and context,
  - can be used to reconstruct “why” a plan or action was approved or rejected.
In the demo, all side effects are confined to:
- in-memory structures,
- local JSON scenarios,
- local UI state.
No real files, services or external systems are touched.